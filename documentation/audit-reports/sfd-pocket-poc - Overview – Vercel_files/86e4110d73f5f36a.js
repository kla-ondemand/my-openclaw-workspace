;!function(){try { var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof global?global:"undefined"!=typeof window?window:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&((e._debugIds|| (e._debugIds={}))[n]="ddf29a4c-5a79-86f3-2e1f-aef32e33149c")}catch(e){}}();
(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,197417,9602070,1080526,e=>{"use strict";var a=e.i(4205214),t=e.i(8660982),i=e.i(2831393),r=e.i(2504781),n=e.i(4030453),l=e.i(6891161),s=e.i(8522580),o=e.i(455575),c=e.i(5338940),d=e.i(5140444);e.i(3512434);var u=e.i(9835407),m=e.i(7917902),p=e.i(6352514),g=e.i(1853611);(0,e.i(7432042).default)("1y");var f=e.i(850302),x=e.i(9257893);e.i(4373123);var y=e.i(5325056),h=e.i(9411809);let b=(0,h.createServerReference)("4085a53e432b8e3827c53ad4dd2baa50c1b3d31280",h.callServer,void 0,h.findSourceMapURL,"createTopUpPurchaseIntent"),v=u.z.object({amount:u.z.number().min(10).max(5e3)}),C=[20,50,100,500];function j(e){let{activeModalType:u,setActiveModalType:h,closeModal:j,autoRechargeConfig:S,isAutoRechargeEnabled:M}=e,{setPurchaseIntent:w,setProviderDetails:A}=(0,y.useCopperClient)(),{data:N}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),{balance:k}=(0,i.useAiCreditsBalance)(),[B,I]=(0,t.useState)("100"),[R,_]=(0,t.useState)(!1),[T,P]=(0,t.useState)(null),[$,E]=(0,t.useState)("ready"),O=""===B||"0"===B,U=Number(B),z=O||Number.isNaN(U)?100:U,{team:D}=(0,c.useTeam)(),{user:F}=(0,d.useUser)(),{account:G}=(0,m.useAccount)(),H=(0,o.useToasts)(),L=(0,t.useCallback)(e=>{let a=e;e.includes(".")?1===e.split(".")[1].length&&(a=`${e}0`):a=`${e}.00`;let t=Number.parseFloat(a);return Number.isNaN(t)||t<10?(P("Minimum amount is $10"),!1):t>5e3?(P(`Maximum amount is $${5e3.toLocaleString()}`),!1):(P(null),t)},[]),W=(0,t.useCallback)(e=>{I(e),P(null),E("ready")},[]),K=(0,t.useMemo)(()=>S&&N||S?`Auto-reload is enabled. Your balance will be restored to $${S.targetBalance} when it falls below $${S.minimumBalance}.`:N?"Auto-reload will be enabled after your first purchase.":"Auto-reload is disabled.",[S,N]),Y=(0,t.useCallback)(async()=>{try{if(!F||!D)return;let e=L(B);if(!e)return;E("in_progress");let a=v.safeParse({amount:e});if(!a.success){a.error.issues[0],e<10?E("amount_too_low"):e>5e3?E("amount_too_high"):E("invalid_amount");return}let t=await b({amount:B,returnUrl:window.location.href,teamIdOrSlug:D.id});E("completed"),w(t.purchaseIntent),A(t.providerDetails),h("checkout")}catch(e){H.error("We're having trouble processing your payment. Please try again."),E("ready"),w(null),A(null),j(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[B,F,D,G,j,w,A,h,L,H]);return(0,a.jsxs)(l.Modal.Modal,{active:"top_up"===u,onClickOutside:j,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Buy AI Gateway Credit"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Purchase credit as a one time top-up to use for your team's AI Gateway usage. Credit expires 1 year after purchase and is only valid for use on AI Gateway."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col items-center gap-4 pb-4",children:[(0,a.jsx)("div",{className:"flex h-[84px] items-center justify-center text-gray-1000",children:R?(0,a.jsxs)("div",{className:"flex items-center justify-center w-full transition-transform duration-200 animate-in zoom-in-95",children:[(0,a.jsx)("span",{className:"text-heading-64 text-gray-1000",children:"$"}),(0,a.jsx)("input",{type:"text",value:B.startsWith("$")?B.slice(1):B,onChange:e=>{let a=e.target.value.replace(/,/g,"").replace(/[^0-9.]/g,"");a.split(".")[0].length>6||W(a)},onBlur:()=>{B&&""!==B||I("100"),_(!1)},autoFocus:!0,className:"text-heading-64 text-start border-none outline-none",style:{width:`${Math.max(3,B.length)}ch`},placeholder:"100"})]}):(0,a.jsx)("div",{className:"flex w-full items-center justify-center transition-transform duration-200 animate-in zoom-in-105 cursor-pointer hover:scale-105",onPointerDown:e=>{e.preventDefault(),_(!0),I(z.toString())},children:(0,a.jsx)(x.default,{className:"text-heading-64 text-gray-1000 cursor-pointer",value:z,format:{style:"currency",currency:"USD"}})})}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-center gap-2",children:[C.map(e=>(0,a.jsxs)(r.Button,{size:"small",type:"secondary",normalStyle:B===e.toString()?{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"}:void 0,onClick:()=>{I(e.toString()),_(!1),P(null),E("ready")},children:["$",e]},e)),(0,a.jsx)(r.Button,{size:"small",type:"secondary",onClick:()=>{_(!0)},normalStyle:C.map(e=>e.toString()).includes(B)?void 0:{backgroundColor:"var(--ds-gray-100)",color:"var(--ds-gray-1000)",borderColor:"var(--ds-gray-alpha-300)"},children:"Custom"})]})]}),T&&(0,a.jsx)(n.Error,{children:T}),M?(0,a.jsx)(s.Note,{action:(0,a.jsx)(r.Button,{size:"small",type:"secondary",onClick:()=>{h("auto_recharge")},children:"Change"}),fill:!0,type:"secondary",children:K}):null]})]}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>h(null),type:"secondary",children:"Cancel"}),(0,a.jsx)(l.Modal.Action,{onClick:Y,disabled:O||!!T,loading:"in_progress"===$,autoFocus:!0,children:"Continue to Payment"})]})]})}var S=e.i(7418514),M=e.i(1637825),w=e.i(5323212),A=e.i(5255926),N=e.i(6446781),k=e.i(6565161),B=e.i(5895979),I=e.i(5883567),R=e.i(57106);let _=(0,h.createServerReference)("400904b620b54b5d8bec825f5fd9fd0273c1664ba5",h.callServer,void 0,h.findSourceMapURL,"completePurchaseIntent"),T=(0,h.createServerReference)("408b6c45677ce4759207e3e0e3c25af6839ca1572f",h.callServer,void 0,h.findSourceMapURL,"confirmPurchaseIntent"),P=(0,h.createServerReference)("40e0f35d19270709979e916a35ba4e3114119a6b22",h.callServer,void 0,h.findSourceMapURL,"createAutoTopupConfig"),$=(0,h.createServerReference)("400dce8de6cb81a89c7685618019d8f0fa7da0df12",h.callServer,void 0,h.findSourceMapURL,"patchPaymentMethod");var E=e.i(6814182),O=e.i(6280036),U=e.i(5978870);let z=(0,B.withBillingContext)(function(e){let{activeModalType:n,setActiveModalType:s,closeModal:u,providerDetails:f,onConversion:x}=e,{purchaseIntent:h}=(0,y.useCopperClient)(),[b,v]=(0,t.useState)("ready"),[C,j]=(0,t.useState)(null),{team:A}=(0,c.useTeam)(),{user:B}=(0,d.useUser)(),{mutate:R}=(0,k.useSWRConfig)(),{account:T}=(0,m.useAccount)(),{paymentMethods:P}=(0,M.useBillingPlatform)(),{balance:O,hasEverPaid:U}=(0,i.useAiCreditsBalance)(),z=(0,E.useStripe)(),D=(0,o.useToasts)(),F=(0,t.useMemo)(()=>{if(P){if(!C){let e=P.defaultSource;return P.sources.find(a=>a.id===e)}return P.sources.find(e=>e.id===C)}},[P,C]),W=(0,t.useMemo)(()=>K(h),[h]),Y=(0,t.useCallback)(async()=>{try{if(v("in_progress"),!A||!z||!F||!B||!h||!f||void 0===O||void 0===W)return;F.billing_details.email||await $({paymentMethodId:F.id,teamIdOrSlug:A.id});let e=await z.initCheckout({fetchClientSecret:()=>Promise.resolve(f.clientSecret)}),a=await e.confirm({redirect:"if_required",paymentMethod:F.id});if("error"===a.type){g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:a.error.message}),D.error("Failed to add funds. Please try again."),v("ready");return}await _({purchaseIntentId:h.id,teamIdOrSlug:A.id}),D.success(`Successfully added $${W} to your AI Gateway Credits balance!`);let t=Number(O)+W;x?.({amount:W,newBalance:t}),await R(`/api/ai/ai-credits-balance?teamId=${A.id}`,()=>({cumulativeBalance:t,hasEverPaid:!0}),{revalidate:!1}),v("completed"),u()}catch(e){D.error("We're having trouble processing your payment. Please try again."),v("ready"),u(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[B,A,T,z,F,h,R,v,f,D,u,W,O,U,x]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===n,onClickOutside:u,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsx)(w.Select,{label:"Payment method",prefix:(0,a.jsx)(S.CardIcon,{brand:F?.card?.brand??"unknown"}),value:F?.id,onChange:e=>{v("ready"),j(e.target.value)},children:P?.sources.map(e=>(0,a.jsx)("option",{value:e.id,children:`${(0,N.cardBrand)(e.card?.brand)} ${e.card?.funding} ending in •••• ${e.card?.last4} ${e.id===P.defaultSource?"(Default)":""}`},e.id))}),(0,a.jsx)(r.Button,{type:"secondary",size:"medium",prefix:(0,a.jsx)(I.PlusCircle,{}),onClick:()=>{s("add_card")},children:"Add payment method"})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(L,{}),(0,a.jsx)(G,{purchaseIntent:h})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:h})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{s("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await Y()},loading:"in_progress"===b,children:"Confirm and Pay"})]})]})});function D(e){var r,n;let{activeModalType:s,setActiveModalType:u,closeModal:x,providerDetails:h,onConversion:b}=e,{purchaseIntent:v}=(0,y.useCopperClient)(),{data:C}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),[j,S]=(0,t.useState)("initializing"),{team:M}=(0,c.useTeam)(),{user:w}=(0,d.useUser)(),{mutate:N}=(0,k.useSWRConfig)(),{account:B}=(0,m.useAccount)(),{balance:I,hasEverPaid:R}=(0,i.useAiCreditsBalance)(),T=(0,o.useToasts)(),{resolvedTheme:$}=(0,O.useTheme)(),E=(0,t.useMemo)(()=>K(v),[v]),z=(0,t.useRef)(null),D=(0,t.useCallback)(async()=>{try{if(S("in_progress"),!M||!w||!v||!h||void 0===I||void 0===E)return void S("ready");if(z.current){let e=await z.current();if(e.success){await _({purchaseIntentId:v.id,teamIdOrSlug:M.id}),T.success(`Successfully added $${E} to your AI Gateway Credits balance!`);let e=Number(I)+E;if(b?.({amount:E,newBalance:e,autoRechargeConfig:C??void 0}),await N(`/api/ai/ai-credits-balance?teamId=${M.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),C)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=C;await P({teamIdOrSlug:M.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),N(`/api/credit-topups?teamId=${M.id}&currency=ai_gateway_credits`),N("deferred-auto-recharge-config",null,{revalidate:!1}),T.success("Auto-reload has been enabled!")}catch(e){T.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}S("completed"),x()}else{g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.error??"Payment checkout failed"}),T.error(e.error??"Failed to add credits. Please try again."),S("ready");return}}else{g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:"Payment handler not initialized"}),T.error("We're having trouble processing your payment. Please try again."),S("ready");return}}catch(e){T.error("We're having trouble processing your payment. Please try again."),S("ready"),x(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[w,M,B,v,N,S,h,T,x,E,I,C,R,b]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===s,onClickOutside:x,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Payment Method"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your default payment method will be used for a one-time charge unless you add a new payment method below."})]}),"initializing"===j?(0,a.jsx)(A.Skeleton,{className:"h-32",width:"100%"}):null,(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:h?(0,a.jsx)(U.CopperPaymentElement,{confirmHandler:z,clientSecret:h.clientSecret,options:{elementsOptions:{appearance:(n={theme:"stripe"},{theme:"flat",variables:{fontSizeBase:"14px",fontSizeSm:"14px",colorTextPlaceholder:(r="dark"===$)?"hsl(240, 3.8%, 60%)":"hsl(240, 3.8%, 46.1%)",colorText:r?"white":"rgb(9, 9, 11)",colorPrimary:"var(--blue-700)",colorDanger:"hsl(0, 84.2%, 60.2%)",borderRadius:"6px",colorBackground:r?"black":"white",focusBoxShadow:r?"rgb(255, 255, 255) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px":"rgb(0, 0, 0) 0px 0px 0px 0px, rgb(161, 161, 170) 0px 0px 0px 1px, rgba(0, 0, 0, 0.05) 0px 1px 2px 0px"},rules:{".Input":{border:r?"1px solid hsl(240, 5.9%, 30%)":"1px solid hsl(240, 5.9%, 90%)",padding:"10px 12px",transition:"all cubic-bezier(0.4, 0, 0.2, 1) 150ms"},".Label":{marginBottom:"8px",color:r?"#999999":"#666666",lineHeight:"20px",fontWeight:"400"},".AccordionItem":{backgroundColor:r?"black":"white"},".Block":{backgroundColor:r?"black":"white"}},...n}),loader:"never",savedPaymentMethod:{enableRedisplay:"auto"}}},onReady:()=>S("ready")}):null}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(L,{}),(0,a.jsx)(G,{purchaseIntent:v})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:v})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{u("top_up"),S("initializing")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await D()},loading:["in_progress","initializing"].includes(j),children:"Confirm and Pay"})]})]})}function F(e){let{activeModalType:r,setActiveModalType:n,closeModal:s,providerDetails:u,onConversion:x}=e,{purchaseIntent:h}=(0,y.useCopperClient)(),{data:b}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),[v,C]=(0,t.useState)("ready"),{team:j}=(0,c.useTeam)(),{user:S}=(0,d.useUser)(),{mutate:M}=(0,k.useSWRConfig)(),{account:w}=(0,m.useAccount)(),{balance:A,hasEverPaid:N}=(0,i.useAiCreditsBalance)(),B=(0,o.useToasts)(),I=(0,t.useMemo)(()=>K(h),[h]),R=(0,t.useCallback)(async()=>{if(j&&S&&h&&u&&void 0!==A&&void 0!==I&&"in_progress"!==v)try{C("in_progress"),await T({purchaseIntentId:h.id,teamIdOrSlug:j.id}),await _({purchaseIntentId:h.id,teamIdOrSlug:j.id}),B.success(`Successfully added $${I} to your AI Gateway Credits balance!`);let e=Number(A)+I;if(x?.({amount:I,newBalance:e,autoRechargeConfig:b??void 0}),await M(`/api/ai/ai-credits-balance?teamId=${j.id}`,()=>({cumulativeBalance:e,hasEverPaid:!0}),{revalidate:!1}),b)try{let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=b;await P({teamIdOrSlug:j.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}),M(`/api/credit-topups?teamId=${j.id}&currency=ai_gateway_credits`),M("deferred-auto-recharge-config",null,{revalidate:!1}),B.success("Auto-reload has been enabled!")}catch(e){B.error("Payment successful, but auto-reload setup failed. Please try setting it up again.")}C("completed"),s()}catch(e){B.error("We're having trouble processing your payment. Please try again."),C("ready"),s(),g.analytics.track(p.AnalyticsEvent.AI_CREDITS_CHECKOUT_ERROR,{message:e.message})}},[S,j,w,h,M,C,v,u,B,s,I,A,b,N,x]);return(0,a.jsxs)(l.Modal.Modal,{active:"checkout"===r,onClickOutside:s,children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsxs)(l.Modal.Header,{children:[(0,a.jsx)(l.Modal.Title,{children:"Confirm Purchase"}),(0,a.jsx)(l.Modal.Subtitle,{children:"Your purchase will be reported to AWS Markeplace for invoicing and payment."})]}),(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial -mx-6 -mb-6 mt-6 px-6 py-4 pt-6 border-t bg-background-200",children:[(0,a.jsx)(L,{}),(0,a.jsx)(G,{purchaseIntent:h})]})]}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial px-6 py-2 border-t bg-background-200",children:(0,a.jsx)(H,{purchaseIntent:h})}),(0,a.jsxs)(l.Modal.Actions,{children:[(0,a.jsx)(l.Modal.Action,{onClick:()=>{n("top_up")},type:"secondary",children:"Back"}),(0,a.jsx)(l.Modal.Action,{onClick:async()=>{await R()},loading:"in_progress"===v,children:"Confirm and Pay"})]})]})}function G(e){let{purchaseIntent:i}=e,r=(0,t.useMemo)(()=>i?i.lineItems?.map(e=>({name:e.name,amount:Number(e.unitAmount)*Number(e.quantity)}))??[]:[],[i]),n=i?.tax?Number(i.tax):0,l=n>0;return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:[r.map((e,t)=>(0,a.jsxs)("div",{className:`flex flex-row items-stretch justify-between gap-4 flex-initial py-2 ${l||t<r.length-1?"border-b":""}`,children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900",children:e.name}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-gray-900",children:`$${e.amount.toFixed(2)}`})]},e.name)),n>0?(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-between gap-4 flex-initial py-4 border-b",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:"Estimated Tax"}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:`$${n.toFixed(2)}`})]}):null]})}function H(e){let{purchaseIntent:t}=e,i=t?.total?Number(t.total):0;return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-1 flex-initial py-2",children:[(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-between gap-4 flex-initial",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:"Total"}),(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium text-foreground",children:`$${i.toFixed(2)}`})]}),(0,a.jsx)("p",{className:"text-label-12 text-gray-900 text-right",children:"* Plus applicable tax and fees"})]})}function L(){return(0,a.jsxs)("p",{className:"text-copy-14 text-gray-900",children:['By pressing "Confirm and Pay" and accessing AI Gateway, you agree to'," ",(0,a.jsx)(R.Link,{href:"/legal/ai-product-terms",className:"text-foreground underline",target:"_blank",children:"Vercel's AI Product Terms."})]})}function W(e){var t;let{isUpdatedStripeElementsEnabled:i}=e,{purchaseIntent:r,providerDetails:n}=(0,y.useCopperClient)();return(t=r,t?.provider?.type==="tackle_aws_marketplace")?(0,a.jsx)(F,{...e,providerDetails:n}):i?(0,a.jsx)(D,{...e,providerDetails:n}):(0,a.jsx)(z,{...e,providerDetails:n})}function K(e){return e?e.lineItems?.filter(e=>"AI Gateway Credits"===e.name).reduce((e,a)=>e+Number(a.unitAmount)*(Number(a.quantity)||1),0):0}var Y=e.i(8158658),q=e.i(2471070);function V(){let{topups:e,loading:a,mutate:t}=(0,q.useAiGatewayCreditTopups)(),i=e?.find(e=>"orb_ledger"!==e.provider.type||"miu"!==e.provider.currency);return{autoRechargeConfig:i?{minimumBalance:i.minimumBalance,targetBalance:i.targetBalance,maximumMonthlySpend:i.maximumMonthlySpend??""}:void 0,loading:a,mutate:t}}e.s(["useAiCreditsAutoRecharge",0,V],9602070);var J=e.i(3500331),Q=e.i(1906681),X=e.i(1448582),Z=e.i(4469437);let ee=(0,h.createServerReference)("402343edaf994164546e394eedda7e98a81edbf637",h.callServer,void 0,h.findSourceMapURL,"deleteAutoTopupConfig"),ea=(0,h.createServerReference)("406f62d3b06052e5cc3eccd4b3af0a3aece504e3a6",h.callServer,void 0,h.findSourceMapURL,"updateAutoTopupConfig"),et=(0,h.createServerReference)("401df1516f0fa529f7986f13388ea4efc180fcd2a9",h.callServer,void 0,h.findSourceMapURL,"get30DaySpend"),ei=u.z.object({minimumBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=5,{message:"Minimum balance must be a whole number and at least $5"}),targetBalance:u.z.string().refine(e=>!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=25,{message:"Target balance must be a whole number and at least $25"}),maximumMonthlySpend:u.z.string().optional().refine(e=>!e||!Number.isNaN(Number(e))&&Number.isInteger(Number(e))&&Number(e)>=50,{message:"Maximum monthly spend must be a whole number and at least $50"})}).refine(e=>{let{minimumBalance:a,targetBalance:t}=e;return Number(t)>Number(a)},{message:"Target balance must be greater than minimum balance",path:["targetBalance"]});function er(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t,type:i}=e;return t?t[i]??"":a?a[i]??"":"minimumBalance"===i?"5":"targetBalance"===i?"25":"maximumMonthlySpend"===i?"50":"0"}function en(e){let{autoRechargeConfig:n,onCancel:l,onComplete:d}=e,{data:u,mutate:m}=(0,f.default)("deferred-auto-recharge-config",{fallbackData:null}),p=n??u??void 0,[g,x]=(0,t.useState)(!!p),[y,h]=(0,t.useState)(null),[b,v]=(0,t.useState)("ready"),[C,j]=(0,t.useState)({}),[S,M]=(0,t.useState)(!1),{balance:w,hasEverPaid:A}=(0,i.useAiCreditsBalance)(),{recommendedMinBalance:N}=function(){let{team:e,isReady:a}=(0,c.useTeam)(),{data:t,isLoading:i,error:r}=(0,f.default)(e?.slug&&a?`ai-gateway-spend-${e.slug}`:null,async()=>e?.slug?et({teamSlug:e.slug}):0);return{recommendedMinBalance:void 0!==t?Math.min(Math.max(Math.ceil(.3*t),5),500):void 0,monthlySpend:t,isLoading:!a||i,error:r}}(),B=!!p!==g||null!==y,{team:I}=(0,c.useTeam)(),{mutate:R}=(0,k.useSWRConfig)(),_=(0,o.useToasts)(),T=function(e){let{autoRechargeConfig:a,draftAutoRechargeConfig:t}=e;return(e,i)=>({minimumBalance:"minimumBalance"===e?i:er({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"minimumBalance"}),targetBalance:"targetBalance"===e?i:er({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"targetBalance"}),maximumMonthlySpend:"maximumMonthlySpend"===e?i:er({autoRechargeConfig:a,draftAutoRechargeConfig:t,type:"maximumMonthlySpend"})})}({autoRechargeConfig:p,draftAutoRechargeConfig:y}),$=(0,t.useCallback)(async()=>{if(!I||!y)return;let{minimumBalance:e,targetBalance:a,maximumMonthlySpend:t}=y;A?(await P({teamIdOrSlug:I.id,minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),R(`/api/credit-topups?teamId=${I.id}&currency=ai_gateway_credits`),_.success("Successfully enabled auto-reload!")):(m({minimumBalance:e,targetBalance:a,maximumMonthlySpend:t??""}),_.success("Auto-reload will be enabled after your first purchase."))},[I,y,R,_,A,m]),E=(0,t.useCallback)(async()=>{if(!I||!n||!y)return;let{maximumMonthlySpend:e,minimumBalance:a,targetBalance:t}=y;await ea({teamIdOrSlug:I.id,updatedMaximumMonthlySpend:e??"",updatedMinimumBalance:a,updatedTargetBalance:t}),R(`/api/credit-topups?teamId=${I.id}&currency=ai_gateway_credits`),_.success("Successfully updated auto-reload!")},[I,n,y,R,_]),O=(0,t.useCallback)(async()=>{I&&n&&(await ee({teamIdOrSlug:I.id}),R(`/api/credit-topups?teamId=${I.id}&currency=ai_gateway_credits`),_.success("Successfully disabled auto-reload!"))},[I,n,R,_,ee]),U=(0,t.useCallback)(async()=>{if(v("in_progress"),!B)return void v("ready");let e=ei.safeParse({minimumBalance:er({autoRechargeConfig:p,draftAutoRechargeConfig:y,type:"minimumBalance"}),targetBalance:er({autoRechargeConfig:p,draftAutoRechargeConfig:y,type:"targetBalance"}),maximumMonthlySpend:er({autoRechargeConfig:p,draftAutoRechargeConfig:y,type:"maximumMonthlySpend"})});if(!e.success){v("ready");let a={};e.error.errors.forEach(e=>{a[e.path[0]]=e.message}),j(a);return}if(void 0!==w&&Number(e.data.minimumBalance)>=Number(w)&&!0===A){v("ready"),j({minimumBalance:"Minimum balance must be lower than your current balance"});return}j({});try{p&&!g?n?await O():m(null):!n&&y?await $():n&&y&&await E(),v("completed"),d?.()}catch{_.error("Failed to update auto-reload. Please try again."),v("ready")}},[n,y,g,p,$,E,O,m,_,B,d,w,v,j,A,N]);return(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsxs)("div",{className:"flex flex-col items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center justify-between gap-2 flex-initial",children:[(0,a.jsx)("p",{className:"text-[14px] leading-[20px] font-medium",children:"Auto-reload"}),(0,a.jsx)(Q.Toggle,{"aria-label":"Enable Auto-reload",checked:g,size:"large",onChange:()=>{x(e=>{let a=!e;return a&&h({minimumBalance:(N??5).toString(),targetBalance:"25",maximumMonthlySpend:""}),j({}),a})}})]}),(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-start gap-4 flex-initial",children:[(0,a.jsx)(J.Input,{"aria-labelledby":"balance-trigger-label",label:"When balance falls below",width:"100%",suffix:"USD",value:er({autoRechargeConfig:p,draftAutoRechargeConfig:y,type:"minimumBalance"}),onChange:e=>{let a=e.target.value;h(()=>T("minimumBalance",a)),C.minimumBalance&&j(e=>({...e,minimumBalance:void 0}));let t=Number(a);!Number.isNaN(t)&&t>=5&&void 0!==N&&t<N?M(!0):M(!1)},disabled:!g,suffixStyling:!1,error:C.minimumBalance}),(0,a.jsx)(J.Input,{"aria-labelledby":"balance-reload-label",label:"Recharge to target balance",width:"100%",suffix:"USD",value:er({autoRechargeConfig:p,draftAutoRechargeConfig:y,type:"targetBalance"}),onChange:e=>{h(()=>T("targetBalance",e.target.value)),C.targetBalance&&j(e=>({...e,targetBalance:void 0}))},disabled:!g,suffixStyling:!1,error:C.targetBalance})]}),(0,a.jsx)(Z.AnimatePresence,{mode:"wait",children:S&&!C.minimumBalance&&(0,a.jsx)(X.m.div,{animate:{height:"auto",opacity:1,marginBottom:0},exit:{height:0,opacity:0,marginBottom:-16},initial:{height:0,opacity:0,marginBottom:-16},style:{overflow:"hidden"},transition:{ease:"easeInOut",duration:.25},children:(0,a.jsxs)(s.Note,{fill:!0,type:"secondary",children:["Based on your usage, we recommend a minimum balance of at least $",N," to ensure sufficient credit for your AI Gateway usage."]})},"min-balance-recommendation")}),(0,a.jsx)("div",{className:"flex flex-col items-stretch justify-start flex-initial",children:(0,a.jsx)(J.Input,{"aria-labelledby":"max-spend-label",label:"Maximum monthly spend",width:"100%",suffix:"USD",placeholder:er({autoRechargeConfig:p,draftAutoRechargeConfig:y,type:"maximumMonthlySpend"}),value:er({autoRechargeConfig:p,draftAutoRechargeConfig:y,type:"maximumMonthlySpend"}),onChange:e=>{h(()=>T("maximumMonthlySpend",e.target.value)),C.maximumMonthlySpend&&j(e=>({...e,maximumMonthlySpend:void 0}))},disabled:!g,suffixStyling:!1,error:C.maximumMonthlySpend})})]}),(0,a.jsxs)("div",{className:"flex flex-row items-stretch justify-end gap-2 flex-initial",children:[l?(0,a.jsx)(r.Button,{type:"secondary",onClick:l,size:"small",children:"Cancel"}):null,(0,a.jsx)(r.Button,{onClick:U,loading:"in_progress"===b,disabled:!B,size:"small",children:"Save Changes"})]})]})}e.s(["AutoRechargeForm",0,en],1080526);var el=e.i(5677444);function es(e){let{activeModalType:t,setActiveModalType:i,autoRechargeConfig:r}=e,n=(0,el.useParams)(),o="string"==typeof n?.teamSlug?n.teamSlug:void 0,{topups:c}=(0,q.useAiGatewayCreditTopups)(),d=c?.some(e=>"orb_ledger"===e.provider.type&&"miu"===e.provider.currency)??!1;return(0,a.jsxs)(l.Modal.Modal,{active:"auto_recharge"===t,onClickOutside:()=>i(null),children:[(0,a.jsxs)(l.Modal.Body,{children:[(0,a.jsx)(l.Modal.Header,{children:(0,a.jsx)(l.Modal.Title,{children:"Enable Auto-reload"})}),d&&o?(0,a.jsx)(s.Note,{fill:!0,children:(0,a.jsxs)("p",{className:"text-copy-14",children:["Buy with MIU is enabled for AI Gateway. Auto-reload is managed in your"," ",(0,a.jsx)(R.Link,{href:`/${o}/~/settings/billing#plan`,variant:"highlight",children:"billing settings"}),"."]})}):(0,a.jsx)(en,{autoRechargeConfig:r,onCancel:()=>i("top_up"),onComplete:()=>i("top_up")})]}),d&&(0,a.jsx)(l.Modal.Actions,{children:(0,a.jsx)(l.Modal.Action,{type:"secondary",onClick:()=>i("top_up"),children:"Back"})})]})}var eo=e.i(3089600),ec=e.i(2166755),ed=e.i(7780974);let eu=(0,t.createContext)(null);e.s(["AddCreditsModalProvider",0,function(e){let{children:r,isUpdatedStripeElementsEnabled:n,isAutoRechargeEnabled:l}=e,{openModal:s,closeModal:o,modals:d}=function(e){let{isUpdatedStripeElementsEnabled:r,isAutoRechargeEnabled:n}=e,{data:l,mutate:s}=(0,f.default)("modal:ai-credits",{fallbackData:null}),o=(0,t.useRef)(void 0),{autoRechargeConfig:d}=V(),{balance:u}=(0,i.useAiCreditsBalance)(),{team:p}=(0,c.useTeam)(),{account:x}=(0,m.useAccount)(),h=(0,ec.useEnvironment)(x),b=(0,t.useRef)(null);(0,eo.default)("modal",(e,a)=>{"top-up"===e&&v(`modal-query${a?.source?`.${a.source}`:""}`)},["source"]);let v=(0,t.useCallback)(e=>{o.current=e,s("top_up"),g.analytics.track(ed.VercelActivityAction.AiGatewayAddCreditsModalOpened,{source:e,previousBalance:u,autoRechargeConfig:d},{send_to:{data_warehouse_legacy:!0}})},[u,d,s]),C=(0,t.useCallback)(()=>{s(null),b.current?.(),o.current=void 0},[s]),S=(0,t.useCallback)(e=>{g.analytics.track(ed.VercelActivityAction.AiGatewayAddCreditsModalCompleted,{source:o.current,previousBalance:u,...e,autoRechargeConfig:e.autoRechargeConfig??d},{send_to:{data_warehouse_legacy:!0}})},[d,u]),M=(0,a.jsxs)(y.CopperProvider,{environment:h,teamIdOrSlug:p?.id,clearPaymentStateRef:b,children:[(0,a.jsx)(j,{activeModalType:l??null,setActiveModalType:s,closeModal:C,isAutoRechargeEnabled:n,autoRechargeConfig:d}),(0,a.jsx)(W,{activeModalType:l??null,setActiveModalType:s,closeModal:C,isUpdatedStripeElementsEnabled:r,onConversion:S}),(0,a.jsx)(Y.default,{active:"add_card"===l,onAdded:()=>{s("checkout")},onCancel:()=>{s("checkout")}}),(0,a.jsx)(es,{activeModalType:l??null,setActiveModalType:s,autoRechargeConfig:d},JSON.stringify(d))]});return{openModal:v,closeModal:C,modals:M}}({isUpdatedStripeElementsEnabled:n,isAutoRechargeEnabled:l});return(0,a.jsxs)(eu.Provider,{value:{openModal:s,closeModal:o,modals:d},children:[r,d]})},"useAddCreditsModalContext",0,function(){let e=(0,t.useContext)(eu);if(!e)throw Error("useAddCreditsModalContext must be used within AddCreditsModalProvider");return e}],197417)},231107,e=>{"use strict";var a=e.i(8660982),t=e.i(3089600);e.s(["useSourceFromParams",0,function(){let[e,i]=(0,a.useState)();return(0,t.default)("source",e=>{i(e)}),e}])},1568642,e=>{"use strict";var a=e.i(4205214),t=e.i(2831393),i=e.i(2504781),r=e.i(5255926),n=e.i(5468328),l=e.i(8660982),s=e.i(6347389),o=e.i(197417),c=e.i(1717203),d=e.i(7557283),u=e.i(5338940),m=e.i(4597921),p=e.i(231107),g=e.i(6468432);e.s(["ViewBalanceAndPurchaseCreditsModal",0,function(){let{type:e="inline"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},f=(0,p.useSourceFromParams)(),{can:x}=(0,c.default)(),y=x(d.Action.Update,d.Resource.PaymentMethod),{team:h,isReady:b}=(0,u.useTeam)(),{balance:v,hasEverPaid:C}=(0,t.useAiCreditsBalance)(),{openModal:j}=(0,o.useAddCreditsModalContext)(),S=h?.billing?.status==="overdue",M=(0,l.useCallback)(e=>{if(void 0===e)return"";let a=Math.max(0,e);return a<100?a.toFixed(2):a<1e3?a.toFixed(0):`${(a/1e3).toFixed(0)}k`},[]),w=(0,m.useServerFlag)("enable-ai-gateway-free-usage-insights",!1);return(0,g.isFlexibleCommitment)(h)?null:(0,a.jsx)("div",{className:"flex items-center gap-2",children:void 0!==v&&b?(0,a.jsx)(n.Tooltip,{position:"bottom",disableTriggers:y&&!S,boxAlign:"center",text:y?"AI Gateway credit purchases are disabled due to an overdue invoice.":"You need additional permissions to manage your team’s AI Gateway credit.",children:(0,a.jsx)(i.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,disabled:!y||S,onClick:()=>j(f?`credits-button.${f}`:"credits-button"),prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?`${M(v)} ${w&&!1===C?"Free Credit":"Credit"}`:"Buy Credit"})}):(0,a.jsx)(r.Skeleton,{children:(0,a.jsx)(i.Button,{type:"on-demand"===e?"default":"secondary",size:"on-demand"===e?"small":void 0,prefix:"inline"===e?(0,a.jsx)(s.Coins,{}):void 0,children:"inline"===e?"Loading Credit":"Buy Credit"})})})}])},1912982,e=>{"use strict";var a=e.i(850302),t=e.i(8042625),i=e.i(5338940);e.s(["usePurchaseIntentAggregate",0,function(){let{start:e,end:r,currency:n,configuration:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{team:s}=(0,i.useTeam)(),o="string"==typeof e?e:e?.toISOString(),c="string"==typeof r?r:r?.toISOString(),d=function(e){let{teamId:a,start:t,end:i,currency:r,configuration:n}=e,l={};if(a&&(l.teamId=a),t&&(l.start=t),i&&(l.end=i),l.property="subtotal",r&&(l.currency="string"==typeof r?r:String(r)),n&&"type"in n&&n.type&&(l["configuration.type"]="string"==typeof n.type?n.type:String(n.type),"options"in n&&n.options&&"currency"in n.options&&n.options.currency)){let e=n.options.currency;l["configuration.options.currency"]="string"==typeof e?e:String(e)}return l}({teamId:s?.id,start:o,end:c,currency:n,configuration:l}),{data:u,error:m,isLoading:p,mutate:g}=(0,a.default)(s?.id?`/api/purchase-intents/aggregate${(0,t.encode)(d)}`:null,async e=>{let a=await fetch(e);if(!a.ok)throw Error(a.statusText);return a.json()});return{count:u?.count,total:u?.total,loading:p,error:m,mutate:g}}])}]);

//# debugId=ddf29a4c-5a79-86f3-2e1f-aef32e33149c
//# sourceMappingURL=14e2842b6083269f.js.map